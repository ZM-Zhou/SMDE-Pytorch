train_dataset:
  - type: CityscapesColorDataset
    params:
      split_file: data_splits/cityscapes/train_extra_stereo_list.txt
      crop_coords: [64, 64, 640, 1984]
      full_size: [384, 1280]
      patch_size: [192, 640]
      normalize_params: [0.411, 0.432, 0.45]
      flip_mode: img
      load_KTmatrix: False
      load_disp: False
      load_semantic: False
      fuse_kitti: True
  - type: KITTIColorDepthDataset
    params:
      split_file: data_splits/kitti/train_list.txt
      full_size: [384, 1280]
      patch_size: [192, 640]
      random_resize: True
      normalize_params: [0.411, 0.432, 0.45]
      flip_mode: img
      color_aug: True
      output_frame: ['o']
      multi_out_scale: null
      load_KTmatrix: False
      load_depth: False
      load_depthhints: False
      is_fixK: True
      stereo_test: False
      jpg_test: False
      improved_test: False

losses:
  param_group:
    loss_terms:
      photo_l1:
        type: PhotoLoss
        rate: 1
        args:
          pred_n: synth_img_{}
          target_n: color_{}_aug
          l1_rate: 1
          other_side: True
      perceptual-1:
        type: PhotoLoss
        rate: 0.01
        args:
          pred_n: synth_feats_0_{}
          target_n: raw_feats_0_{}
          l1_rate: 0
          l2_rate: 1
      perceptual-2:
        type: PhotoLoss
        rate: 0.01
        args:
          pred_n: synth_feats_1_{}
          target_n: raw_feats_1_{}
          l1_rate: 0
          l2_rate: 1
      perceptual-3:
        type: PhotoLoss
        rate: 0.01
        args:
          pred_n: synth_feats_2_{}
          target_n: raw_feats_2_{}
          l1_rate: 0
          l2_rate: 1
      smooth:
        type: SmoothLoss
        rate: 0.0008
        args:
          pred_n: disp_{}
          image_n: color_{}
          gamma_rate: 2
          more_kernel: True
          gray_img: True
      selfhints:
        type: HintsLoss
        rate: 0.01
        mask: occ_fine_{}
        args:
          pred_n: warp_img_fine_{}
          pred_depth_n: fine_depth_{}
          target_n: color_{}_norm
          hints_n: warp_img_{}
          hints_depth_n: tar_depth_{}
          recons_rate: 0
      smooth-2:
        type: SmoothLoss
        rate: 0.0016
        args:
          pred_n: fine_disp_{}
          image_n: color_{}
          gamma_rate: 2
          more_kernel: True
          gray_img: True

visual:
  type:
    color_s: img
    color_o: img
    disp_s: disp
    fine_disp_s: disp
    warp_img_fine_s: img
    synth_img_s: img
    delta_1_1_s: vector
    delta_2_1_s: vector
    delta_3_1_s: vector
    delta_1_2_s: vector
    delta_2_2_s: vector
    delta_3_2_s: vector
    delta_1_3_s: vector
    delta_2_3_s: vector
    delta_3_3_s: vector

  shape: [[color_s,  color_s, color_o],
          [disp_s, warp_img_fine_s, synth_img_s],
          [fine_disp_s, [color_s, delta_3_1_s, 1], [color_s, disp_s, 2]],
          [delta_3_1_s, delta_3_2_s, delta_3_3_s],
          [delta_2_1_s, delta_2_2_s, delta_2_3_s],
          [delta_1_1_s, delta_1_2_s, delta_1_3_s]]

_train: options/_base/datasets/kitti/train_384rc.yaml
_val: options/_base/datasets/kitti/test_384.yaml
_base: options/_base/networks/sdfa_net.yaml
